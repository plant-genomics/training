<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="Anna Syme">
    <link rel="canonical" href="https://plant-genomics.github.io/training/modules/docker/">
    <link rel="shortcut icon" href="../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Docker - Plant Genomics Training</title>
    <link href="../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">
    <link href="../../css/style.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../js/jquery-3.2.1.min.js"></script>
    <script src="../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Containers", url: "#_top", children: [
              {title: "The basics", url: "#the-basics" },
              {title: "Getting files in and out of containers", url: "#getting-files-in-and-out-of-containers" },
              {title: "Example: assemble and annotate a bacterial genome", url: "#example-assemble-and-annotate-a-bacterial-genome" },
              {title: "Troubleshooting", url: "#troubleshooting" },
              {title: "Links", url: "#links" },
          ]},
        ];

    </script>
    <script src="../../js/base.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-154956469-2', 'auto');
        ga('send', 'pageview');
    </script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h2 id="containers">Containers</h2>
<ul>
<li>Containers are a collection of tools and their dependencies, packaged into a file.</li>
<li>You can download and run this file and its software, without directly installing the software itself.</li>
<li>Types of containers: Docker, Singularity</li>
</ul>
<h3 id="the-basics">The basics</h3>
<ul>
<li>Download and install Docker Desktop: <a href="https://www.docker.com/products/docker-desktop">https://www.docker.com/products/docker-desktop</a></li>
<li>Open docker (e.g.: if it&rsquo;s running, it may show an icon in the top menu bar).</li>
<li>In the terminal (or equivalent):</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">docker pull busybox   //pulls the image named &quot;busybox&quot; from DockerHub</span>
<span class="err">docker run busybox    //creates the container, then exits if no tasks are running</span>
<span class="err">docker run busybox ls //creates container, lists files, exits</span>
<span class="err">docker image ls       //lists all docker images</span>
<span class="err">docker --help         // docker help</span>
</code></pre></div>


<h3 id="getting-files-in-and-out-of-containers">Getting files in and out of containers</h3>
<ul>
<li>We will make a folder that can get share files with our containers.</li>
<li>In your home directory (/Users/yourname/):</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">mkdir</span><span class="w"> </span><span class="n">workspace</span><span class="w">     </span>
<span class="n">cd</span><span class="w"> </span><span class="n">workspace</span><span class="w"></span>
<span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/[</span><span class="n">yourname</span><span class="o">]/</span><span class="nl">workspace</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="w"> </span><span class="n">busybox</span><span class="w"> </span><span class="n">touch</span><span class="w"> </span><span class="k">data</span><span class="o">/</span><span class="n">plantfile</span><span class="w"></span>
</code></pre></div>


<ul>
<li><ss>-v</ss> connectes our local &ldquo;workspace&rdquo; folder with a &ldquo;data&rdquo; folder in the container.</li>
<li>Around this, we <ss>docker run busybox</ss></li>
<li>Finally, we create a file with <ss>touch data/plantfile</ss></li>
</ul>
<h3 id="example-assemble-and-annotate-a-bacterial-genome">Example: assemble and annotate a bacterial genome</h3>
<ul>
<li>Get some sample data files (synthetic bacterial illumina reads):</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">wget https://zenodo.org/record/582600/files/mutant_R1.fastq?download=1</span>
<span class="err">wget https://zenodo.org/record/582600/files/mutant_R2.fastq?download=1</span>
</code></pre></div>


<ul>
<li>Shorten the names:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">mv mutant_R1.fastq?download=1 mutant_R1.fastq</span>
<span class="err">mv mutant_R2.fastq?download=1 mutant_R2.fastq</span>
</code></pre></div>


<ul>
<li>Run the assembly tool (spades) in a container:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/[</span><span class="n">yourname</span><span class="o">]/</span><span class="nl">workspace</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="w"> </span><span class="n">quay</span><span class="p">.</span><span class="n">io</span><span class="o">/</span><span class="n">biocontainers</span><span class="o">/</span><span class="nl">spades</span><span class="p">:</span><span class="mf">3.13.0</span><span class="c1">--0 ./usr/local/bin/spades.py -1 data/mutant_R1.fastq -2 data/mutant_R2.fastq -o data/spades_outdir</span>
</code></pre></div>


<ul>
<li><ss>quay.io/biocontainers/spades:3.13.0&ndash;0</ss> is the image name</li>
<li><ss>./usr/local/bin/spades.py</ss> is the command to run spades</li>
<li><ss>-1</ss> specifies the file with forward reads, <fn>data/mutant_R1.fastq<//fn></li>
<li><ss>-2</ss> specifies the file with reverse reads, <fn>data/mutant_R2.fastq<//fn></li>
<li><ss>-o</ss> specifies the output directory, <fn>data/spades_outdir</fn></li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">ls      //to see the output files in your local workspace folder</span>
</code></pre></div>


<ul>
<li>Move the assembled reads - the contigs file - into the workspace folder:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">mv spades_outdir/contigs.fasta .</span>
</code></pre></div>


<ul>
<li>Run the annotation tool (prokka) in a container:</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="n">docker</span><span class="w"> </span><span class="n">run</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="o">/</span><span class="n">Users</span><span class="o">/[</span><span class="n">yourname</span><span class="o">]/</span><span class="nl">workspace</span><span class="p">:</span><span class="o">/</span><span class="k">data</span><span class="o">/</span><span class="w"> </span><span class="n">ummidock</span><span class="o">/</span><span class="nl">prokka</span><span class="p">:</span><span class="mf">1.13.3</span><span class="o">-</span><span class="mi">01</span><span class="w"> </span><span class="n">prokka</span><span class="w"> </span><span class="n">contigs</span><span class="p">.</span><span class="n">fasta</span><span class="w"></span>
</code></pre></div>


<ul>
<li><ss>ummidock/prokka:1.13.3-01</ss> is the image name</li>
<li><ss>prokka</ss> is the command to run prokka</li>
<li>the input file is <fn>contigs.fasta</fn></li>
<li>this container has been configured to start within the data folder, so &ldquo;data/&rdquo; is not needed before the input file</li>
<li>this container has also been configured to put output in the data folder, so it is not necessary to specify an output directory name</li>
</ul>
<div class="codehilite"><pre><span></span><code><span class="err">ls                        //to see the annotation output</span>
<span class="err">cd PROKKA_outfile_name</span>
<span class="err">less PROKKA_outfile.txt   //summary of annotation</span>
</code></pre></div>


<h3 id="troubleshooting">Troubleshooting</h3>
<p>How do we know what the command is to run the tool?</p>
<ul>
<li>Run the container interactively:</li>
<li>e.g.<code>docker run -it ummidock/prokka:1.13.3-01</code></li>
<li>Try the tool name and the help flag: e.g. <code>prokka -h</code></li>
</ul>
<p>How do we know if the container has a data folder?</p>
<ul>
<li>Run the container, print the working directory:</li>
<li>e.g. <code>docker run ummidock/prokka:1.13.3-01 pwd</code>
<!-- alternately: <code>docker image inspect &lt;container name&gt; --format '{{json .ContainerConfig.WorkingDir}}'</code> --></li>
<li>If the working directory is called &ldquo;workdir&rdquo;, use that in place of &ldquo;data&rdquo;</li>
<li>e.g. <code>-v /Users/[yourname]/workspace:/workdir/</code></li>
</ul>
<h3 id="links">Links</h3>
<p>Docker: <a href="https://docs.docker.com/get-started/">https://docs.docker.com/get-started/</a></p>

  <br>
</div>

<footer class="container-fluid wm-page-content"><p><br><br><br><br><br><br><br>&copy; The authors; 2020-</p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>